{% extends 'base.html' %}

{% block content %}
<div class="container">
    <div class="row mb-4">
        <div class="col">
            <h2 class="h4">
                <i class="fas fa-edit me-2"></i>
                Editar Meta: {{ meta.tipo_medida }}
            </h2>
            <p class="text-muted">Rutina: {{ rutina.titulo }} | Cliente: {{ rutina.cliente.nombres }} {{ rutina.cliente.apellidos }}</p>
        </div>
    </div>

    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="card">
                <div class="card-body">
                    <form method="POST">
                        <div class="mb-3">
                            <label for="tipo_medida" class="form-label">Tipo de Medida</label>
                            <select class="form-select" id="tipo_medida" name="tipo_medida" onchange="actualizarUnidad()" required>
                                {% for tipo, unidad in tipos_medidas %}
                                <option value="{{ tipo }}" data-unidad="{{ unidad }}" 
                                        {% if meta.tipo_medida == tipo %}selected{% endif %}>
                                    {{ tipo }}
                                </option>
                                {% endfor %}
                                <option value="Otro" {% if meta.tipo_medida not in [t[0] for t in tipos_medidas] %}selected{% endif %}>
                                    Otro (personalizado)
                                </option>
                            </select>
                        </div>
                        
                        <div class="mb-3">
                            <label for="medida_inicial" class="form-label">Medida Inicial</label>
                            <div class="input-group">
                                <input type="number" step="0.1" class="form-control" id="medida_inicial" 
                                       name="medida_inicial" value="{{ meta.medida_inicial }}" required>
                                <span class="input-group-text unidad-display">{{ meta.unidad }}</span>
                                <input type="hidden" id="unidad" name="unidad" value="{{ meta.unidad }}">
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label for="medida_objetivo" class="form-label">Medida Objetivo</label>
                            <div class="input-group">
                                <input type="number" step="0.1" class="form-control" id="medida_objetivo" 
                                       name="medida_objetivo" value="{{ meta.medida_objetivo }}" required>
                                <span class="input-group-text unidad-display">{{ meta.unidad }}</span>
                            </div>
                        </div>
                        
                        <div class="mb-3" id="unidad-personalizada" style="display: none;">
                            <label for="unidad_custom" class="form-label">Unidad de Medida</label>
                            <input type="text" class="form-control" id="unidad_custom" 
                                   value="{{ meta.unidad if meta.tipo_medida not in [t[0] for t in tipos_medidas] else '' }}">
                        </div>
                        
                        <div class="form-check mb-3">
                            <input class="form-check-input" type="checkbox" id="logrado" name="logrado" 
                                   {% if meta.logrado %}checked{% endif %}>
                            <label class="form-check-label" for="logrado">
                                Marcar como logrado
                            </label>
                        </div>
                        
                        <div class="mb-3">
                            <label for="notas" class="form-label">Notas</label>
                            <textarea class="form-control" id="notas" name="notas" rows="3">{{ meta.notas }}</textarea>
                        </div>
                        
                        <div class="d-flex justify-content-end gap-2">
                            <a href="{{ url_for('meta.lista_metas', rutina_id=rutina.id) }}" class="btn btn-secondary">
                                <i class="fas fa-times me-1"></i> Cancelar
                            </a>
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save me-1"></i> Actualizar Meta
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
function actualizarUnidad() {
    const select = document.getElementById('tipo_medida');
    const unidadTexto = document.getElementsByClassName('unidad-display');
    const unidadInput = document.getElementById('unidad');
    const unidadPersonalizada = document.getElementById('unidad-personalizada');
    
    if (select.value === 'Otro') {
        unidadPersonalizada.style.display = 'block';
        
        // Actualizar unidad cuando se cambie el campo personalizado
        document.getElementById('unidad_custom').addEventListener('input', function(e) {
            const customUnidad = e.target.value || '-';
            for (let el of unidadTexto) {
                el.textContent = customUnidad;
            }
            unidadInput.value = customUnidad;
        });
    } else {
        unidadPersonalizada.style.display = 'none';
        
        const selectedOption = select.options[select.selectedIndex];
        const unidad = selectedOption.getAttribute('data-unidad') || '-';
        
        for (let el of unidadTexto) {
            el.textContent = unidad;
        }
        unidadInput.value = unidad;
    }
}

document.addEventListener('DOMContentLoaded', function() {
    // Inicializar unidad al cargar la p√°gina
    const select = document.getElementById('tipo_medida');
    if (select.value === 'Otro') {
        document.getElementById('unidad-personalizada').style.display = 'block';
    }
});
</script>
{% endblock %} 