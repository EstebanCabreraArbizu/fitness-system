{% extends 'base.html' %}

{% block content %}
<div class="container">
    <div class="row mb-4">
        <div class="col">
            <h2 class="h4">
                <i class="fas fa-bullseye me-2"></i>
                Nueva Meta para Rutina: {{ rutina.titulo }}
            </h2>
            <p class="text-muted">Cliente: {{ rutina.cliente.nombres }} {{ rutina.cliente.apellidos }}</p>
        </div>
    </div>

    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="card">
                <div class="card-body">
                    <form method="POST">
                        <div class="mb-3">
                            <label for="tipo_medida" class="form-label">Tipo de Medida</label>
                            <select class="form-select" id="tipo_medida" name="tipo_medida" onchange="actualizarUnidad()" required>
                                <option value="">Seleccione un tipo de medida</option>
                                {% for tipo, unidad in tipos_medidas %}
                                <option value="{{ tipo }}" data-unidad="{{ unidad }}">{{ tipo }}</option>
                                {% endfor %}
                                <option value="Otro">Otro (personalizado)</option>
                            </select>
                        </div>
                        
                        <div class="mb-3">
                            <label for="medida_inicial" class="form-label">Medida Inicial</label>
                            <div class="input-group">
                                <input type="number" step="0.1" class="form-control" id="medida_inicial" 
                                       name="medida_inicial" required>
                                <span class="input-group-text" id="unidad-texto">-</span>
                                <input type="hidden" id="unidad" name="unidad" value="">
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label for="medida_objetivo" class="form-label">Medida Objetivo</label>
                            <div class="input-group">
                                <input type="number" step="0.1" class="form-control" id="medida_objetivo" 
                                       name="medida_objetivo" required>
                                <span class="input-group-text unidad-display">-</span>
                            </div>
                        </div>
                        
                        <div class="mb-3" id="unidad-personalizada" style="display: none;">
                            <label for="unidad_custom" class="form-label">Unidad de Medida</label>
                            <input type="text" class="form-control" id="unidad_custom" 
                                   placeholder="Ejemplo: cm, kg, %, rep">
                        </div>
                        
                        <div class="mb-3">
                            <label for="notas" class="form-label">Notas</label>
                            <textarea class="form-control" id="notas" name="notas" rows="3"></textarea>
                        </div>
                        
                        <div class="d-flex justify-content-end gap-2">
                            <a href="{{ url_for('meta.lista_metas', rutina_id=rutina.id) }}" class="btn btn-secondary">
                                <i class="fas fa-times me-1"></i> Cancelar
                            </a>
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save me-1"></i> Guardar Meta
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
function actualizarUnidad() {
    const select = document.getElementById('tipo_medida');
    const unidadTexto = document.getElementsByClassName('unidad-display');
    const unidadInput = document.getElementById('unidad');
    const unidadPersonalizada = document.getElementById('unidad-personalizada');
    
    if (select.value === 'Otro') {
        unidadPersonalizada.style.display = 'block';
        
        // Actualizar unidad cuando se cambie el campo personalizado
        document.getElementById('unidad_custom').addEventListener('input', function(e) {
            const customUnidad = e.target.value || '-';
            for (let el of unidadTexto) {
                el.textContent = customUnidad;
            }
            unidadInput.value = customUnidad;
        });
    } else {
        unidadPersonalizada.style.display = 'none';
        
        const selectedOption = select.options[select.selectedIndex];
        const unidad = selectedOption.getAttribute('data-unidad') || '-';
        
        for (let el of unidadTexto) {
            el.textContent = unidad;
        }
        unidadInput.value = unidad;
    }
}

document.addEventListener('DOMContentLoaded', function() {
    // Inicializar unidad al cargar la p√°gina
    actualizarUnidad();
});
</script>
{% endblock %} 