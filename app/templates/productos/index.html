<!DOCTYPE html>
<html lang="es">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Gestión de Productos Fitness</title>
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
	<link rel="stylesheet" href="{{url_for('static', filename='css/styles.css')}}">
</head>

<body>
	<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
		<div class="container">
			<a class="navbar-brand" href="../index.html">FitTrainer</a>
			<button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
				<span class="navbar-toggler-icon"></span>
			</button>
			<div class="collapse navbar-collapse" id="navbarNav">
				<ul class="navbar-nav ms-auto">
					<li class="nav-item">
						<a class="nav-link" href="../clientes/index.html">Clientes</a>
					</li>
					<li class="nav-item">
						<a class="nav-link" href="../instructores/index.html">Instructores</a>
					</li>
					<li class="nav-item">
						<a class="nav-link active" href="index.html">Productos</a>
					</li>
					<li class="nav-item">
						<a class="nav-link" href="../disciplinas/index.html">Disciplinas</a>
					</li>
				</ul>
			</div>
		</div>
	</nav>

	<div class="container mt-4">
		<div class="d-flex justify-content-between align-items-center mb-4">
			<h1>Productos Vitamínicos Fitness</h1>
			<button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#productoModal">
				<i class="bi bi-plus-lg"></i> Nuevo Producto
			</button>
		</div>

		<div class="card shadow-sm">
			<div class="card-body">
				<div class="row mb-3">
					<div class="col-md-4">
						<input type="text" id="searchProducto" class="form-control" placeholder="Buscar producto...">
					</div>
					<div class="col-md-2">
						<select id="filterStatus" class="form-select">
							<option value="">Todos</option>
							<option value="1">Activo</option>
							<option value="0">Inactivo</option>
						</select>
					</div>
					<div class="col-md-2">
						<button class="btn btn-sm btn-outline-secondary" onclick="clearAllFilters()">Limpiar filtros</button>
					</div>
				</div>

				<div class="row" id="productosGrid">
					<!-- Se llenará con JavaScript -->
				</div>

				<nav aria-label="Paginación de productos">
					<ul class="pagination justify-content-center" id="productosPagination">
						<!-- Se llenará con JavaScript -->
					</ul>
				</nav>
			</div>
		</div>
	</div>

	<!-- Modal para Crear/Editar Producto -->
	<div class="modal fade" id="productoModal" tabindex="-1" aria-hidden="true">
		<div class="modal-dialog modal-lg">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title" id="modalTitle">Nuevo Producto</h5>
					<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
				</div>
				<div class="modal-body">
					<form id="productoForm">
						<input type="hidden" id="productoId">
						<div class="row mb-3">
							<div class="col-md-8">
								<label for="title" class="form-label">Título</label>
								<input type="text" class="form-control" id="title" required>
							</div>
							<div class="col-md-4">
								<label for="category" class="form-label">Categoría</label>
								<input type="number" class="form-control" id="category">
							</div>
						</div>
						<div class="mb-3">
							<label for="description" class="form-label">Descripción</label>
							<textarea class="form-control" id="description" rows="3"></textarea>
						</div>
						<div class="row mb-3">
							<div class="col-md-6">
								<label for="marca" class="form-label">Marca</label>
								<input type="text" class="form-control" id="marca" required>
							</div>
							<div class="col-md-6">
								<label for="palabras_claves" class="form-label">Palabras Clave</label>
								<input type="text" class="form-control" id="palabras_claves" required>
							</div>
						</div>
						<div class="row mb-3">
							<div class="col-md-3">
								<label for="price" class="form-label">Precio de Venta Actual ($)</label>
								<input type="number" step="0.01" class="form-control" id="price">
							</div>
							<div class="col-md-3">
								<label for="descuento" class="form-label">Precio a descontar ($)</label>
								<input type="number" step="0.01" class="form-control" id="descuento">
							</div>
							<div class="col-md-3">
								<label for="previous_price" class="form-label">Precio Anterior ($)</label>
								<input type="number" step="0.01" class="form-control" id="previous_price">
							</div>
							<div class="col-md-3">
								<label for="purchase_price" class="form-label">Precio de Compra del producto ($)</label>
								<input type="number" step="0.01" class="form-control" id="purchase_price">
							</div>
						</div>
						<div class="row mb-3">
							<div class="col-md-4">
								<label for="fecha_inicio" class="form-label">Fecha Inicio</label>
								<input type="date" class="form-control" id="fecha_inicio">
							</div>
							<div class="col-md-4">
								<label for="fecha_fin" class="form-label">Fecha Fin</label>
								<input type="date" class="form-control" id="fecha_fin">
							</div>
							<div class="col-md-4">
								<label for="status" class="form-label">Estado</label>
								<select class="form-select" id="status" required>
									<option value="1">Activo</option>
									<option value="0">Inactivo</option>
								</select>
							</div>
						</div>
						<!-- <div class="row mb-3">
							<div class="col-md-6">
								<label for="profesor" class="form-label">Profesor</label>
								<input type="text" class="form-control" id="profesor" required>
							</div>
							<div class="col-md-6">
								<label for="profesor_foto" class="form-label">Foto del Profesor</label>
								<input type="file" class="form-control" id="profesor_foto">
							</div>
						</div> -->
						<div class="row mb-3">
							<div class="col-md-4">
								<div class="form-check">
									<input class="form-check-input" type="checkbox" id="relevant" value="1">
									<label class="form-check-label" for="relevant">Relevante</label>
								</div>
							</div>
							<div class="col-md-4">
								<div class="form-check">
									<input class="form-check-input" type="checkbox" id="outstanding" value="1" checked>
									<label class="form-check-label" for="outstanding">Destacado</label>
								</div>
							</div>
						</div>
						<div class="mb-3">
							<label class="form-label">Imágenes del Producto</label>
							<input type="file" class="form-control mb-2" id="productImages" multiple>
							<div id="imagePreviewContainer" class="row">
								<!-- Se llenará con JavaScript -->
							</div>
						</div>
						<div class="mb-3">
							<label class="form-label">Asignar a Instructores</label>
							<div id="instructoresList" class="row">
								<!-- Se llenará con JavaScript -->
							</div>
						</div>
					</form>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
					<button type="button" class="btn btn-primary" id="saveProducto">Guardar</button>
				</div>
			</div>
		</div>
	</div>

	<!-- Modal para Ver Detalles del Producto -->
	<div class="modal fade" id="viewProductoModal" tabindex="-1" aria-hidden="true">
		<div class="modal-dialog modal-lg">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title">Detalles del Producto</h5>
					<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
				</div>
				<div class="modal-body">
					<div class="row">
						<div class="col-md-6">
							<div id="productoImageCarousel" class="carousel slide" data-bs-ride="carousel">
								<div class="carousel-inner" id="productoImagenes">
									<!-- Se llenará con JavaScript -->
								</div>
								<button class="carousel-control-prev" type="button"
									data-bs-target="#productoImageCarousel" data-bs-slide="prev">
									<span class="carousel-control-prev-icon" aria-hidden="true"></span>
									<span class="visually-hidden">Anterior</span>
								</button>
								<button class="carousel-control-next" type="button"
									data-bs-target="#productoImageCarousel" data-bs-slide="next">
									<span class="carousel-control-next-icon" aria-hidden="true"></span>
									<span class="visually-hidden">Siguiente</span>
								</button>
							</div>
						</div>
						<div class="col-md-6">
							<h3 id="productoTitle"></h3>
							<p class="badge bg-primary" id="productoMarca"></p>
							<p class="badge bg-success" id="productoStatus"></p>

							<div class="d-flex align-items-center mt-3">
								<h4 id="productoPrecio" class="me-2"></h4>
								<span id="productoDescuento" class="text-decoration-line-through text-muted"></span>
							</div>

							<p class="mt-3" id="productoDescripcion"></p>

							<div class="mt-3">
								<p><strong>Palabras clave:</strong> <span id="productoPalabrasClave"></span></p>
								<p><strong>Disponible:</strong> <span id="productoFechas"></span></p>
							</div>
						</div>
					</div>
					<hr>
					<div class="row mt-3">
						<!-- <div class="col-md-4 text-center">
							<img id="productoProfesorFoto"
								src="{{ url_for('static', filename='img/producto-default.png') }}"
								class="img-fluid rounded-circle" alt="Foto de profesor"
								style="width: 100px; height: 100px; object-fit: cover;">
							<p class="mt-2"><strong>Profesor:</strong> <span id="productoProfesor"></span></p>
						</div> -->
						<div class="col-md-8">
							<h5>Instructores Asignados</h5>
							<div id="productoInstructores" class="row">
								<!-- Se llenará con JavaScript -->
							</div>
						</div>
					</div>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
				</div>
			</div>
		</div>
	</div>

	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
	<script src="{{url_for('static', filename = 'js/productos.js')}}"></script>
	<script>
		const URLS = {
			instructores: "{{ url_for('product.get_instructores') }}",
			producto: function(id) { return "{{ url_for('product.get_product', id=0) }}".replace('0', id); },
			addProducto: "{{ url_for('product.add_product') }}",
			updateProducto: function(id) { return "{{ url_for('product.update_product', id=0) }}".replace('0', id); },
			deleteProducto: function(id) { return "{{ url_for('product.delete_product', id=0) }}".replace('0', id); }
		}
	</script>
	<script>
		const productos = {{ products| tojson | safe}};
		const instructores = [];

		document.addEventListener('DOMContentLoaded', function () {
			fetch(URLS.instructores)
				.then(response => {
					if (!response.ok) {
						throw new Error(`Error HTTP ${response.status}: ${response.statusText}`);
					}
					return response.json();
				})
				.then(data => {
					instructores.length = 0;
					data.forEach(instructor => instructores.push(instructor));
					renderProductosGrid();
					renderInstructoresList();
				})
				.catch(error => {
					console.error('Error al cargar instructores:', error);
					// Mostrar un mensaje al usuario
					showNotification('Error al cargar los instructores. Por favor, recargue la página.', 'danger');
					// Aún así renderizar productos
					renderProductosGrid();
				});
			// Asignar eventos a botones
			document.getElementById('saveProducto').addEventListener('click', saveProducto);
			document.getElementById('productImages').addEventListener('change', previewProductImages);
			// document.getElementById('profesor_foto').addEventListener('change', previewProfesorFoto);
		})
	</script>
</body>

</html>